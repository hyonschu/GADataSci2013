> library(stats)
> library(ggplot2)
> set.seed(1)
> d <- data.frame()
> d <- rbind(d, data.frame(x=1 + rnorm(20, 0, 0.1), y=1 + rnorm(20, 0, 0.1), label=as.factor(rep(1, each=20))))
> d <- rbind(d, data.frame(x=1 + rnorm(20, 0, 0.1), y=3 + rnorm(20, 0, 0.1), label=as.factor(rep(2, each=20))))
> d <- rbind(d, data.frame(x=3 + rnorm(20, 0, 0.1), y=1 + rnorm(20, 0, 0.1), label=as.factor(rep(3, each=20))))
> d <- rbind(d, data.frame(x=3 + rnorm(20, 0, 0.1), y=3 + rnorm(20, 0, 0.1), label=as.factor(rep(4, each=20))))
> ggplot(d, aes(x=x, y=y)) + geom_point(aes(colour=label)) + ggtitle('d -- easy clusters')
> result1 <- kmeans(d[,1:2],4)
> result1
K-means clustering with 4 clusters of sizes 20, 20, 20, 20

Cluster means:
          x         y
1 3.0265022 0.9641555
2 0.9782726 0.9596490
3 1.0481246 2.9836669
4 3.0024491 3.0075839

Clustering vector:
 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 
 2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  3  3  3  3  3  3  3  3  3  3  3  3  3  3  3 
36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 
 3  3  3  3  3  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  4  4  4  4  4  4  4  4  4  4 
71 72 73 74 75 76 77 78 79 80 
 4  4  4  4  4  4  4  4  4  4 

Within cluster sum of squares by cluster:
[1] 0.4563276 0.3510448 0.3365015 0.4264411
 (between_SS / total_SS =  99.0 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss" "betweenss"   
[7] "size"        
> d$cluster1 <- as.factor(result1$cluster)
> d
           x         y label cluster1
1  0.9494043 0.8085641     1        2
2  1.1343039 1.1176583     1        2
3  0.9785421 0.8335028     1        2
4  0.9820443 0.9536470     1        2
5  0.9899809 0.8884080     1        2
6  1.0712666 0.9249181     1        2
7  0.9926436 1.2087167     1        2
8  0.9962366 1.0017396     1        2
9  0.9318340 0.8713699     1        2
10 0.9675730 0.8359394     1        2
11 1.0060160 1.0450187     1        2
12 0.9411106 0.9981440     1        2
13 1.0531496 0.9681932     1        2
14 0.8481606 0.9070638     1        2
15 1.0306558 0.8512540     1        2
16 0.8463550 0.8924808     1        2
17 0.9699024 1.1000029     1        2
18 0.9471720 0.9378733     1        2
19 0.9347905 0.8615573     1        2
20 0.9943103 1.1869291     1        2
21 1.0425100 2.8768677     2        3
22 0.9761353 3.0983896     2        3
23 1.1058483 3.0219925     2        3
24 1.0886423 2.8532750     2        3
25 0.9380757 3.0521023     2        3
26 1.2206102 2.9841245     2        3
27 0.9744973 3.1464587     2        3
28 0.8575505 2.9233918     2        3
29 0.9855600 2.9569788     2        3
30 1.0207538 2.9073891     2        3
31 1.2307978 2.9822896     2        3
32 1.0105802 3.0402012     2        3
33 1.0456999 2.9268252     2        3
34 0.9922847 3.0830373     2        3
35 0.9665999 2.8791917     2        3
36 0.9965274 2.8952016     2        3
37 1.0787640 3.1441158     2        3
38 1.2075245 2.8984153     2        3
39 1.1027392 3.0411975     2        3
40 1.1207908 2.9618924     2        3
41 3.0409402 0.8266782     3        1
42 3.1688873 1.0002132     3        1
43 3.1586588 0.9369700     3        1
44 2.9669092 0.9659031     3        1
45 2.7714764 0.8843428     3        1
46 3.2497662 1.1803142     3        1
47 3.0667066 0.9668868     3        1
48 3.0541327 0.8394487     3        1
49 2.9986600 1.0197193     3        1
50 3.0510108 1.0263176     3        1
51 2.9835624 0.9014173     3        1
52 3.0420695 0.7111079     3        1
53 2.9599753 0.9359518     3        1
54 2.8629792 1.0570508     3        1
55 3.0987838 0.9940277     3        1
56 3.1519745 0.9901821     3        1
57 2.9691259 1.0560821     3        1
58 2.8746710 0.8813541     3        1
59 3.0642241 1.1096777     3        1
60 2.9955291 0.9994656     3        1
61 3.0707311 3.0951013     4        4
62 3.1034108 2.9610763     4        4
63 3.0223480 2.9715669     4        4
64 2.9121292 3.0857410     4        4
65 3.1162965 3.1719627     4        4
66 2.7999835 3.0270055     4        4
67 2.9455209 2.9577816     4        4
68 2.9744329 2.8810887     4        4
69 2.9833879 2.9668967     4        4
70 3.1020464 2.9060171     4        4
71 3.0136222 2.9741067     4        4
72 3.0407168 3.0394379     4        4
73 2.9930345 2.9148143     4        4
74 2.9752336 3.2649167     4        4
75 3.0695551 3.0156012     4        4
76 3.1146228 3.1130207     4        4
77 2.7596904 2.7710876     4        4
78 3.0572740 3.0741001     4        4
79 3.0374724 2.8683755     4        4
80 2.9574732 3.0919804     4        4
> ggplot(d, aes(x=x, y=y)) + geim_point(aes(color=cluster1)) + ggtitle("lmeans result 1 - success!\n(k=4)")
Error: could not find function "geim_point"
> ggplot(d, aes(x=x, y=y)) + geom_point(aes(color=cluster1)) + ggtitle("lmeans result 1 - success!\n(k=4)")
> ggplot(d, aes(x=x, y=y)) + geom_point(aes(color=cluster1)) + ggtitle("kmeans result 1 - success!\n(k=4)")
> result2 <- kmeans(d[,1:2], 4)
> result2
K-means clustering with 4 clusters of sizes 40, 8, 20, 12

Cluster means:
          x         y
1 2.0252869 2.9956254
2 3.1262515 1.0255737
3 0.9782726 0.9596490
4 2.9600026 0.9232101

Clustering vector:
 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 
 3  3  3  3  3  3  3  3  3  3  3  3  3  3  3  3  3  3  3  3  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1 
36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 
 1  1  1  1  1  4  2  2  4  4  2  2  4  4  2  4  4  4  4  2  2  4  4  2  4  1  1  1  1  1  1  1  1  1  1 
71 72 73 74 75 76 77 78 79 80 
 1  1  1  1  1  1  1  1  1  1 

Within cluster sum of squares by cluster:
[1] 38.96250557  0.07779851  0.35104484  0.19556751
 (between_SS / total_SS =  75.9 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss" "betweenss"   
[7] "size"        
> d$cluster2 <- as.factor(result2$cluster)
> ggplot(d, aes(x=x, y=y)) + geom_point(aes(colour=cluster2)) + ggtitle('kmeans result2 -- trouble\n(k=4)')
> result3 <- kmeans(d[,1:2], 4, nstart=10)
> d$cluster3 <- as.factor(result3$cluster)
> ggplot(d, aes(x=x, y=y)) + geom_point(aes(colour=cluster3)) + ggtitle('kmeans result3 -- stable convergence\n(k=4, nstart=10)')
> d2 <- rbind(d[,1:3], data.frame(x=1000+rnorm(20,0,50), y=1000+rnorm(20,0,50), label=as.factor(rep(5, each=20))))
> ggplot(d2, aes(x=x, y=y)) + geom_point(aes(colour=label)) + ggtitle('d2 -- multiple length scales')
> result4 <- kmeans(d2[,1:2], 5, nstart=10)
Error: unexpected input in "Ã”"
> d2$cluster4 <- as.factor(result4$cluster)
> ggplot(d2, aes(x=x, y=y)) + geom_point(aes(colour=cluster4)) + ggtitle('kmeans result4 -- trouble\n(k=5, nstart=10)')
> result4 <- kmeans(d2[,1:2], 5, nstart=10)
d2$cluster4 <- as.factor(result4$cluster)
ggplot(d2, aes(x=x, y=y)) + geom_point(aes(colour=cluster4)) + ggtitle('kmeans result4 -- trouble\n(k=5, nstart=10)')
> iris.result <- kmeans(iris[,1:4], 3)
> iris.result$cluster
  [1] 2 1 1 1 2 2 2 2 1 1 2 2 1 1 2 2 2 2 2 2 2 2 2 2 1 1 2 2 2 1 1 2 2 2 1 2 2 2 1 2 2 1 1 2 2 1 2 1 2 2
 [51] 3 3 3 3 3 3 3 1 3 3 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 3 3 3 3 1 3
[101] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
> iris2 <- cbind(iris, cluster=as.factor(iris.result$cluster))
> library(gridExtra)
Loading required package: grid
> p1 <- ggplot(iris2, aes(x=Sepal.Width, y=Petal.Width)) + geom_point(aes(colour=cluster)) + ggtitle('clustering results')
> p2 <- ggplot(iris, aes(x=Sepal.Width, y=Petal.Width)) + geom_point(aes(colour=Species)) + ggtitle('true labels')
> grid.arrange(p1, p2)
> 